
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="PyTorch Quantization Framework For OCP MX Datatypes.">
      
      
      
      
        <link rel="prev" href="../custom_float_cast/">
      
      
        <link rel="next" href="../mx_tensor/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>torchmx.mx_quantization_utils - torchmx Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#torchmxmx_quantization_utils" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="torchmx Documentation" class="md-header__button md-logo" aria-label="torchmx Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            torchmx Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              torchmx.mx_quantization_utils
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m3.55 19.09 1.41 1.41 1.8-1.79-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71 1.8 1.79 1.41-1.41-1.79-1.8M20.45 5l-1.41-1.4-1.8 1.79 1.42 1.42M13 1h-2v3h2M6.76 5.39 4.96 3.6 3.55 5l1.79 1.81zM1 13h3v-2H1m12 9h-2v3h2"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/rain-neuromorphics/torchmx" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    torchmx
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/mx_matmul/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../results/llama3.1%20results/" class="md-tabs__link">
          
  
  
  Results

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../user_docs/User%20API%20Home/" class="md-tabs__link">
          
  
  
  User API Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../Developer%20API%20Home/" class="md-tabs__link">
          
  
  
  Developer API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="torchmx Documentation" class="md-nav__button md-logo" aria-label="torchmx Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    torchmx Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rain-neuromorphics/torchmx" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    torchmx
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/mx_matmul/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MX Matmul
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/quantize_linear/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantize Linear
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/quantize_llama/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantize Llama
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Results
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Results
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../results/llama3.1%20results/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Llama3.1 Results
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            User API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_docs/User%20API%20Home/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User API Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_docs/mx_tensor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.mx_tensor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_docs/quant_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.quant_api
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_docs/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.config
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_docs/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_docs/dtypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.dtypes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_docs/env_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.env_variables
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Developer API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Developer API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Developer%20API%20Home/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer API Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.config
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom_float_cast/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.custom_float_cast
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    torchmx.mx_quantization_utils
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    torchmx.mx_quantization_utils
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#unpack_bfloat16" class="md-nav__link">
    <span class="md-ellipsis">
      unpack_bfloat16
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unpack_fp32" class="md-nav__link">
    <span class="md-ellipsis">
      unpack_fp32
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unpack_fp64" class="md-nav__link">
    <span class="md-ellipsis">
      unpack_fp64
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dequantize_to_dtype" class="md-nav__link">
    <span class="md-ellipsis">
      dequantize_to_dtype
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#round_to_even" class="md-nav__link">
    <span class="md-ellipsis">
      round_to_even
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#n_ones" class="md-nav__link">
    <span class="md-ellipsis">
      n_ones
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#leading_one_position" class="md-nav__link">
    <span class="md-ellipsis">
      leading_one_position
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quantize_mx_with_e8m0_shared_exponent_hw_exact" class="md-nav__link">
    <span class="md-ellipsis">
      quantize_mx_with_e8m0_shared_exponent_hw_exact
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get_fp_scale" class="md-nav__link">
    <span class="md-ellipsis">
      get_fp_scale
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quantize_mx_with_e8m0_shared_exponent_simulated" class="md-nav__link">
    <span class="md-ellipsis">
      quantize_mx_with_e8m0_shared_exponent_simulated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get_e8m0_shared_exponent" class="md-nav__link">
    <span class="md-ellipsis">
      get_e8m0_shared_exponent
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mx_tensor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.mx_tensor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.ops
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quant_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.quant_api
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dtypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.dtypes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../env_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    torchmx.env_variables
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#unpack_bfloat16" class="md-nav__link">
    <span class="md-ellipsis">
      unpack_bfloat16
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unpack_fp32" class="md-nav__link">
    <span class="md-ellipsis">
      unpack_fp32
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unpack_fp64" class="md-nav__link">
    <span class="md-ellipsis">
      unpack_fp64
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dequantize_to_dtype" class="md-nav__link">
    <span class="md-ellipsis">
      dequantize_to_dtype
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#round_to_even" class="md-nav__link">
    <span class="md-ellipsis">
      round_to_even
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#n_ones" class="md-nav__link">
    <span class="md-ellipsis">
      n_ones
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#leading_one_position" class="md-nav__link">
    <span class="md-ellipsis">
      leading_one_position
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quantize_mx_with_e8m0_shared_exponent_hw_exact" class="md-nav__link">
    <span class="md-ellipsis">
      quantize_mx_with_e8m0_shared_exponent_hw_exact
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get_fp_scale" class="md-nav__link">
    <span class="md-ellipsis">
      get_fp_scale
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quantize_mx_with_e8m0_shared_exponent_simulated" class="md-nav__link">
    <span class="md-ellipsis">
      quantize_mx_with_e8m0_shared_exponent_simulated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get_e8m0_shared_exponent" class="md-nav__link">
    <span class="md-ellipsis">
      get_e8m0_shared_exponent
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<p><a id="torchmx.mx_quantization_utils"></a></p>
<h1 id="torchmxmx_quantization_utils">torchmx.mx_quantization_utils</h1>
<p><a id="torchmx.mx_quantization_utils.unpack_bfloat16"></a></p>
<h4 id="unpack_bfloat16">unpack_bfloat16</h4>
<p><span style="float: right; font-size: 90%;">
<a href="https://github.com/rain-neuromorphics/torchmx/blob/abhijit/add-contrib/docs/../torchmx/mx_quantization_utils.py#L16">[view source]</a>
</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">unpack_bfloat16</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p>Extract the sign, exponent, and mantissa from a bfloat16 tensor</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>x</code> - torch.Tensor, the input bfloat16 tensor</li>
<li><code>dtype</code> - torch.dtype, the dtype to cast the output tensors to. Default is torch.uint8</li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>sign</code> - torch.Tensor, the sign of the tensor in uint8</li>
<li><code>exponent</code> - torch.Tensor, the exponent of the tensor in uint8</li>
<li><code>mantissa</code> - torch.Tensor, the mantissa of the tensor in uint8</li>
</ul>
<p><a id="torchmx.mx_quantization_utils.unpack_fp32"></a></p>
<h4 id="unpack_fp32">unpack_fp32</h4>
<p><span style="float: right; font-size: 90%;">
<a href="https://github.com/rain-neuromorphics/torchmx/blob/abhijit/add-contrib/docs/../torchmx/mx_quantization_utils.py#L51">[view source]</a>
</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">unpack_fp32</span><span class="p">(</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>        <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p>Unpacks the given FP32 tensor to its components.</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>x</code> <em>torch.Tensor</em> - The packed FP32 tensor.</li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>sign</code> <em>torch.Tensor</em> - The sign bit tensor.</li>
<li><code>exponent</code> <em>torch.Tensor</em> - The exponent tensor.</li>
<li><code>mantissa</code> <em>torch.Tensor</em> - The mantissa tensor..</li>
</ul>
<p><a id="torchmx.mx_quantization_utils.unpack_fp64"></a></p>
<h4 id="unpack_fp64">unpack_fp64</h4>
<p><span style="float: right; font-size: 90%;">
<a href="https://github.com/rain-neuromorphics/torchmx/blob/abhijit/add-contrib/docs/../torchmx/mx_quantization_utils.py#L72">[view source]</a>
</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">unpack_fp64</span><span class="p">(</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>        <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p>Unpacks the given FP64 tensor to its components.</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>x</code> <em>torch.Tensor</em> - The packed FP64 tensor.</li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>sign</code> <em>torch.Tensor</em> - The sign bit tensor.</li>
<li><code>exponent</code> <em>torch.Tensor</em> - The exponent tensor.</li>
<li><code>mantissa</code> <em>torch.Tensor</em> - The mantissa tensor..</li>
</ul>
<p><a id="torchmx.mx_quantization_utils.dequantize_to_dtype"></a></p>
<h4 id="dequantize_to_dtype">dequantize_to_dtype</h4>
<p><span style="float: right; font-size: 90%;">
<a href="https://github.com/rain-neuromorphics/torchmx/blob/abhijit/add-contrib/docs/../torchmx/mx_quantization_utils.py#L93">[view source]</a>
</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">dequantize_to_dtype</span><span class="p">(</span><span class="n">data_lp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>                        <span class="n">elem_dtype</span><span class="p">:</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>                        <span class="n">target_dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>                        <span class="n">packing_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>                        <span class="n">is_packed_fp4</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div></td></tr></table></div>
<p>Dequantizes a elem_dtype packed as unit8 to the target_dtype by using an intermediate bfloa16 representation.</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>data_lp</code> <em>torch.Tensor</em> - The input tensor in low-precision format (must be of dtype torch.uint8).</li>
<li><code>elem_dtype</code> <em>dtypes.DType</em> - The input element data type</li>
<li><code>target_dtype</code> <em>torch.dtype</em> - The target data type to which the tensor will be dequantized.</li>
<li><code>is_packed_fp4</code> <em>bool, optional</em> - A flag indicating whether the input tensor is packed in FP4
  format. Defaults to True.</li>
<li><code>packing_dim</code> <em>int</em> - The dimension along which the uint4 data is packed, default is -1.</li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>torch.Tensor</code> - The dequantized tensor in the specified target data type.</li>
</ul>
<p><strong>Raises</strong>:</p>
<ul>
<li><code>AssertionError</code> - If the element data type is not supported or if the input tensor is not of dtype torch.uint8.</li>
</ul>
<p><a id="torchmx.mx_quantization_utils.round_to_even"></a></p>
<h4 id="round_to_even">round_to_even</h4>
<p><span style="float: right; font-size: 90%;">
<a href="https://github.com/rain-neuromorphics/torchmx/blob/abhijit/add-contrib/docs/../torchmx/mx_quantization_utils.py#L149">[view source]</a>
</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">round_to_even</span><span class="p">(</span><span class="n">mantissa</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>                  <span class="n">mantissa_shift</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div></td></tr></table></div>
<p>Round a mantissa to the nearest even value using a tensor of shift values.</p>
<p><strong>Arguments</strong>:</p>
<p>mantissa (torch.Tensor) : A tensor containing the mantissa values to be rounded.
- <code>mantissa_shift</code> <em>torch.Tensor | int</em> - A tensor containing the shift values
  to be applied to each element of the <code>mantissa</code> tensor.
  The size of the <code>mantissa_shift</code> tensor should match the size of the <code>mantissa</code> tensor.
  Alternatively, a single integer value can be provided, in which case the same shift value
  will be applied to all elements of the <code>mantissa</code> tensor.</p>
<p><strong>Returns</strong>:</p>
<p>torch.Tensor
  A tensor containing the mantissa values rounded to the nearest even value.
  The size of the output tensor will match the input <code>mantissa</code> tensor.</p>
<p>Notes</p>
<hr />
<ul>
<li>The rounding follows the "round half to even" rule, where if the value
  to be discarded is exactly halfway between two integers, the result is rounded
  to the nearest even number.</li>
<li>This function supports element-wise operations, where the shifting is applied
  to each element of the mantissa according to the corresponding value in <code>mantissa_shift</code>.</li>
</ul>
<p>Examples</p>
<hr />
<blockquote>
<blockquote>
<blockquote>
<p>mantissa = torch.tensor([0b1010011, 0b1101101], dtype=torch.int32)
mantissa_shift = torch.tensor([2, 3], dtype=torch.int32)
round_to_even(mantissa, mantissa_shift)
  tensor([41, 27])</p>
</blockquote>
</blockquote>
</blockquote>
<p><a id="torchmx.mx_quantization_utils.n_ones"></a></p>
<h4 id="n_ones">n_ones</h4>
<p><span style="float: right; font-size: 90%;">
<a href="https://github.com/rain-neuromorphics/torchmx/blob/abhijit/add-contrib/docs/../torchmx/mx_quantization_utils.py#L218">[view source]</a>
</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">n_ones</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</code></pre></div></td></tr></table></div>
<p>Returns a number with n ones in binary representation.
for example: _n_ones(3) = 0b111 = 7</p>
<p><a id="torchmx.mx_quantization_utils.leading_one_position"></a></p>
<h4 id="leading_one_position">leading_one_position</h4>
<p><span style="float: right; font-size: 90%;">
<a href="https://github.com/rain-neuromorphics/torchmx/blob/abhijit/add-contrib/docs/../torchmx/mx_quantization_utils.py#L227">[view source]</a>
</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">leading_one_position</span><span class="p">(</span><span class="n">mantissa</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">mantissa_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Determine the position of the leading one bit in each element of the input tensor with LBS at
position 0. If there is no 1 in the mantissa, the function returns -1.</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>mantissa</code> <em>torch.Tensor</em> - A tensor containing the mantissa values to be analyzed.
  Each element should be an integer.</li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>torch.Tensor</code> - the position of the leading one bit in each element of the input tensor.</li>
</ul>
<p><a id="torchmx.mx_quantization_utils.quantize_mx_with_e8m0_shared_exponent_hw_exact"></a></p>
<h4 id="quantize_mx_with_e8m0_shared_exponent_hw_exact">quantize_mx_with_e8m0_shared_exponent_hw_exact</h4>
<p><span style="float: right; font-size: 90%;">
<a href="https://github.com/rain-neuromorphics/torchmx/blob/abhijit/add-contrib/docs/../torchmx/mx_quantization_utils.py#L253">[view source]</a>
</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">quantize_mx_with_e8m0_shared_exponent_hw_exact</span><span class="p">(</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>        <span class="n">data_hp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>        <span class="n">elem_dtype</span><span class="p">:</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>        <span class="n">shared_exponent</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>        <span class="n">orig_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div></td></tr></table></div>
<p>A hardware-exact MX quantization function that handles the division and conversion
to that target element data type explicitly.</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>data_hp</code> <em>torch.Tensor</em> - The high precision input tensor, (dtype=torch.bfloat16).</li>
<li><code>elem_dtype</code> <em>dtypes.DType</em> - The target element data type for quantization.</li>
<li><code>shared_exponent</code> <em>torch.Tensor</em> - The E8M0 scale shared exponent (dtype=torch.uint8).</li>
<li><code>orig_shape</code> <em>torch.Size</em> - The original shape of the input tensor, used to reshape the output
  tensor. Optional, defaults to None.</li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>torch.Tensor</code> <em>dtype=torch.uint8</em> - The quantized tensor in the target lower precision format.</li>
</ul>
<p><strong>Raises</strong>:</p>
<ul>
<li><code>AssertionError</code> - If the provided elem_dtype is not supported.</li>
</ul>
<p><a id="torchmx.mx_quantization_utils.get_fp_scale"></a></p>
<h4 id="get_fp_scale">get_fp_scale</h4>
<p><span style="float: right; font-size: 90%;">
<a href="https://github.com/rain-neuromorphics/torchmx/blob/abhijit/add-contrib/docs/../torchmx/mx_quantization_utils.py#L415">[view source]</a>
</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_fp_scale</span><span class="p">(</span><span class="n">shared_exp_e8m0</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div></td></tr></table></div>
<p>Takes the shared exponent of the MX scale, FP8(0-8-0), as a biased uint8 exponent</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>shared_exp_e8m0</code> <em>torch.Tensor</em> - the shared exponent of the FP8(0-8-0) scale</li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>torch.Tensor</code> - FP32 scale, 2**(shared_exponent - 127), with NaNs handling</li>
</ul>
<p><a id="torchmx.mx_quantization_utils.quantize_mx_with_e8m0_shared_exponent_simulated"></a></p>
<h4 id="quantize_mx_with_e8m0_shared_exponent_simulated">quantize_mx_with_e8m0_shared_exponent_simulated</h4>
<p><span style="float: right; font-size: 90%;">
<a href="https://github.com/rain-neuromorphics/torchmx/blob/abhijit/add-contrib/docs/../torchmx/mx_quantization_utils.py#L435">[view source]</a>
</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">quantize_mx_with_e8m0_shared_exponent_simulated</span><span class="p">(</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>        <span class="n">data_hp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>        <span class="n">elem_dtype</span><span class="p">:</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>        <span class="n">shared_exponent</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>        <span class="n">orig_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div></td></tr></table></div>
<p>Simulated MX quantization function inspired by torchao. It accepts high precision input tensor
(data_hp), the MX scale shared exponent (shared_exponent), and returns the quantized tensor
in the elem_dtype. The steps are:
1. normalize data_hp by performing a single-precision division with an MX scale in
torch.float32
2. quantize the normalized data_hp to the target elem_dtype by using the native torhcao function</p>
<p>We call this implementation simulated because it is not an efficient hardware implementation</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>data_hp</code> <em>torch.Tensor</em> - The high precision input tensor, dtype is either torch.bfloat16 or torch.float</li>
<li><code>elem_dtype</code> <em>dtypes.DType</em> - The target element data type for quantization.</li>
<li><code>shared_exponent</code> <em>torch.Tensor</em> - The E8M0 scale shared exponent (dtype=torch.uint8).</li>
<li><code>orig_shape</code> <em>torch.Size</em> - The original shape of the input tensor, used to reshape the output
  tensor. Optional, defaults to None.</li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>torch.Tensor</code> <em>dtype=torch.uint8</em> - The quantized tensor in the target lower precision format.</li>
</ul>
<p><strong>Raises</strong>:</p>
<ul>
<li><code>AssertionError</code> - If the provided elem_dtype is not supported.</li>
</ul>
<p><a id="torchmx.mx_quantization_utils.get_e8m0_shared_exponent"></a></p>
<h4 id="get_e8m0_shared_exponent">get_e8m0_shared_exponent</h4>
<p><span style="float: right; font-size: 90%;">
<a href="https://github.com/rain-neuromorphics/torchmx/blob/abhijit/add-contrib/docs/../torchmx/mx_quantization_utils.py#L502">[view source]</a>
</span></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_e8m0_shared_exponent</span><span class="p">(</span><span class="n">data_hp</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>                             <span class="n">elem_dtype</span><span class="p">:</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">DType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div></td></tr></table></div>
<p>Computes the shared exponent for a given high-precision tensor.</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>data_hp</code> <em>torch.Tensor</em> - High-precision input tensor, with block size as the last dimension.
  dtype must be torch.bfloat16 or torch.float.</li>
<li><code>elem_dtype</code> <em>dtypes.DType</em> - target element dtype</li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><code>torch.Tensor</code> - MX-scale exponent tensor as torch.uint8</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>